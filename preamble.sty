\usepackage{import}
\usepackage{textcomp} % fractions
\usepackage{titlesec}
\usepackage{makecell}
\usepackage{imakeidx} % Must load before hyperref else index isn't linked
\usepackage[acronym,toc]{glossaries}
\usepackage{hyperref}
\usepackage{fontspec}
\usepackage{tocbibind}
\usepackage{blindtext} % TODO: dev dependency, remove once finished
\usepackage{caption}
\usepackage{multicol}
\usepackage{tabularx}
\usepackage{xltabular}
\usepackage[a4paper]{geometry}
\usepackage[table]{xcolor}
\usepackage{enumitem}

\setmainfont{Open Sans}

\makeindex[intoc]
\makeglossaries

% Alternating row colors
\newcommand{\unclassedblankrowcolor}{\rowcolor{white}}
\newcommand{\unclassedrowcolors}{
    \rowcolors{1}{white}{gray!30}
}

% Formatting for sub-table title
% Argument 1: number of columns for multicolumn
% Argument 2: subtable title
\newcommand{\unclassedsubtabletitle}[2]{
    \unclassedblankrowcolor
    \multicolumn{#1}{l}{
        \Gape[6pt][0pt]{
            \textbf{\textit{#2}}
        }
    }
}

\captionsetup{justification=raggedright,singlelinecheck=false}

% Forces neat ragged-bottom multicols
\setlength{\parskip}{0pt plus0pt minus0pt}

% Un-numbered section titles
\titleformat{\section}{\normalfont\huge\bfseries}{}{0pt}{}[\hrule]
\titleformat{\subsection}{\normalfont\Large\bfseries}{}{0pt}{}
\titleformat{\subsubsection}{\normalfont\normalsize\bfseries}{}{0pt}{}

% Reduce itemize separation (relies on package enumitem)
\setlist[itemize]{nosep}
\setlist[enumerate]{nosep}

% Chapter title formatting (basically reduced space)
\titleformat
{\chapter}
[display]
{\normalfont\bfseries\Huge} % Size here applies to whole chapter heading
{\itshape\huge \chaptertitlename \ \thechapter} % Size here just applies to "Chapter X"
{0pt}
{}
{}

\titlespacing{\chapter}{0pt}{0pt}{0pt}

% Subsection title formatting (reduced space)
\titlespacing{\subsection}{0pt}{5pt}{0pt}

% Statblock definition (this is a big one)
% Parameter 1: Name
% Parameter 2: Level
% Parameter 3: Section 1 (Attributes, left col)
% Parameter 4: Section 1 (Attributes, right col)
% Parameter 5: Section 2 (Basic stats)
% Parameter 6: Section 3 (Defence)
% Parameter 7: Section 4 (Skills and features)
% Parameter 8: Section 5 (Actions (includes spells))
% Parameter 9: Section 6 (Other (equipment, etc.))
\newcommand{\statblock}[9]
{
    % No first-line indentation in the stat block
    \setlength{\parindent}{0pt}

    % Title / Level
    {\normalfont\huge\bfseries #1}
    \hfill
    {\normalfont\Large\bfseries Level #2}
    % TODO: level is a two-line high minipage with XP earned on second line,
    % with text justified to right.

    \hrule

    % Attributes
    \begin{minipage}{.45\linewidth}#3\end{minipage}
    \hfill
    \begin{minipage}{.45\linewidth}#4\end{minipage}

    \hrule

    % Basic stats
    #5

    \hrule

    % Defence
    #6

    \hrule

    % Skills and features
    #7

    \hrule

    % Actions (includes spells)
    #8

    \hrule

    % Other (equipment, etc.)
    #9

    \hrule
}

% Some notes on why stat blocks are the way they are:
% - With all skills being written out as e.g. Vision (SEN), and most unexpected
%   usages of skills being untrained ones, you should be able to quickly
%   calculate untrained skills by just taking the ATT. This is why only trained
%   or modified skills are listed, and attributes get top-billing (plus
%   attributes look nice)
